const
    courseApi = require('../api/course_service'),
    process = require('process')
;

courseApi.createCourse(
    {
        "courseTitle" : "Wisp CLEUR18 Viptela",
        "courseSlug" : "Introduction to Ciscoâ€™s SD-WAN Solution - Viptela",
        "courseName" : "LABCRS-2629",
        "splashTitle" : "Viptela",
        "splashInstructions" : "Please select your student number from the dropdown above to continue",
        "userNomenclature" : "Student",
        "buttons" : [
            {
                "data" : "<h2>Session Information</h2><div class=\"table-responsive\"><table class=\"table table--bordered\"><tbody><tr><th>Name</th><th>Title</th><th>Contact</th></tr><tr><td>Andrew Horrigan</td><td>Network Consulting Information</td><td>anhorrig@cisco.com</td></tr><tr><td>Rebecca Zhu</td><td>Technical Leader Services</td><td>rzhu@cisco.com</td></tr><tr><td>Sadiq Yakasai</td><td>Technical Leader Services</td><td>syakasai@cisco.com</td></tr><tr><td>Krista Mitchell</td><td>Network Consulting Information</td><td>kacciari@cisco.com</td></tr></tbody></table></div><p class=\"text-center\"><img style=\"width: 50%; height: 50%\" src=\"/images/SVS_Logo.png\" /></p>",
                "name" : "Session Information",
                "id" : "494079144969",
                "description" : "Session Information",
                "selector" : "session-information",
                "icon" : "info"
            },
            {
                "data" : "<h2>Infrastructure Addresses</h2><div class=\"table-responsive\"><table class=\"table table--bordered\"><tbody><tr><th>Device</th><th>IP Address</th><th>Credentials</th></tr><tr><td><a href=\"http://10.1.60.28\">WISP-vBranch</a></td><td>10.1.60.28</td><td>student/Cisc#123</td></tr><tr><td>{{student-abbrev}}-vEdge</td><td>10.1.61.{{number}}1</td><td>admin/admin</td></tr><tr><td><a href=\"http://10.1.48.231\">vManage</a></td><td>10.1.48.31</td><td>student/Cisc#123</td></tr><tr><td>WISP-Client</td><td>10.1.60.37</td><td>student/Cisc#123</td></tr></tbody></table></div>",
                "name" : "Connection Information",
                "selector" : "connection-information",
                "description" : "Connection Information",
                "icon" : "ethernet",
                "id" : "343993433"
            }
        ],
        "__v" : 0,
        "coursePath" : "wisp-cleur18-viptela",
        "children" : [
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Welcome to LABCRS-2629!</h1><p>This lab was designed to introduce attendees to installing and operationalizing Viptela for their branch environments.</p><h2>Abstract</h2><p>Viptela joined Cisco in July 2017. Viptela&rsquo;s Software-Defined WAN (SD-WAN) is an overlay architecture that is built on Viptela Fabric, and creates secure, unified connectivity over any transport (MPLS, Broadband, LTE, VSAT, etc.) and provides simplified operations with centralized management, policy control and application visibility across the enterprise. This lab serves as an introduction to the Viptela SD-WAN solution. The lab environment is pre-built and shared, including vManage, vBond, and vSmart virtual machines along with the underlying data center infrastructure. Once students understand basic SD-WAN architectures and functionality, they will deploy their own vEdge Router on one of Cisco&rsquo;s NFVI platforms (CSP-2100) using a day0 configuration file. Students will then register the vEdge to the vManage orchestrator, and ensure the fabric tunnel is established, allowing for a policy to be pushed and for routes to be learned. Students will verify traffic flows between sites, and will use route policies to determine the flow of traffic.</p><p class=\"text-center\"><img style=\"width: 40%; height: 40%\" src=\"/uploads/07cff891-47b6-2681-a81b-accd805b0cdb.png\" /></p>",
                "name" : "Welcome",
                "id" : "309987354048",
                "path" : "welcome"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Topology Information</h1><p>This lab was designed to support (5) students concurrently. Each student has access to (2) CSP-2100s - <strong>WISP-vBranch</strong> and <strong>SAE-CSP1</strong>. The first CSP-2100 will be used for students to deploy and configure their own Branch-vEdge. WISP-vBranch is connected to a pair of switches emulating two &quot;public&quot; networks - <strong>Internet</strong> and <strong>MPLS</strong>. The second CSP-2100 resides inside of the data center, and will host the termination point for each of the student branch environments. Students will use the <strong>WISP-Client</strong> to test the tunnels being created between the Branch-vEdge and the WISP-vEdge.</p><p>The topology diagram below illustrates the lab topology. The red <strong>X</strong> represents the student number. <strong>This pod is for {{student-name}}.</strong> During the course of this guide, students will be instructed when to use their student numbers.</p><p class=\"text-center\"><img width=\"1772\" height=\"763\" style=\"width: 90%; height: 90%\" src=\"/uploads/5efcbda0-692e-f19e-d7cf-ffcd1b58d581.png\" /></p><div class=\"note\">This lab topology is being shared with another lab at Cisco Live, entitled <em><strong>LTRCLD-2121 - Virtualize, Orchestrate and Automate Your DMZ Extranet, Internet, and Public Cloud Connections with Secure Agile Exchange.</strong></em> Because of Viptela&#39;s versatility and powerful SD-WAN capabilities, it is being positioned in a number of solutions at Cisco. SAE securely connects users - employees, customers and partners - to applications across private data centers, public IaaS clouds, and/or public SaaS clouds. SAE was designed for these hybrid cloud environments, ensuring optimal connectivity, security, speed, and agility. Built around the basic principles of Network Functions Virtualization (NFV), SAE enables customers to use Virtual Network Functions (VNF) and network orchestration to replace traditional physical environments with scalable, highly-secure, and agile service chains.<p>&nbsp;</p><p class=\"text-center\"><strong>If you would like to know more about SAE and how Viptela is enabling customers to improve their hybrid-cloud capabilities, please consider attending LTRCLD-2121!</strong></p></div>",
                "name" : "Topology Information",
                "id" : "735186179213",
                "path" : "topology-information"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Connection Information</h1><p>The management subnets for this lab are <strong>10.1.60.0/23</strong> (vEdge, CSP-2100, NFS) and <strong>10.1.48.x/24</strong> (vManage, vBond, vSmart). In the upper-right hand corner of the browser, students can click on the small, round icon with bi-directional arrows to display an overlay with following IP addressing.</p><h2>Infrastructure Addresses</h2><div class=\"table-responsive\"><table class=\"table table--bordered\"><tbody><tr><th>Device</th><th>IP Address</th><th>Credentials</th></tr><tr><td><a href=\"http://10.1.60.28\">WISP-vBranch</a></td><td>10.1.60.28</td><td>student/Cisc#123</td></tr><tr><td>{{student-abbrev}}-vEdge</td><td>10.1.61.{{number}}1</td><td>admin/admin</td></tr><tr><td><a href=\"http://10.1.48.231\">vManage</a></td><td>10.1.48.231</td><td>student/Cisc#123</td></tr><tr><td>WISP-Client</td><td>10.1.60.37</td><td>student/Cisc#123</td></tr></tbody></table></div><h3>Accessing the GUI</h3><p>The CSP-2100 and Viptela&#39;s vManage utilize web-based GUIs. In order to access these portals, please use the <strong>Chrome Web Browser</strong>, which has been pre-installed on the Windows jump host. There is a folder on the Bookmarks Bar entitled <strong>WISP Bookmarks</strong>, which contains bookmarks for both devices.</p><p><img src=\"/uploads/1de9ce23-79cb-3177-0058-0c8ce4d3d7f6.png\" /></p><h3>Accessing the CLI</h3><p>Once the student-vEdge is given a management address, the virtual machine can be reached via SSH. Located on the desktop, please use <strong>Smartty</strong> to access the device&#39;s CLI. Once Smartty is open, use the filter box in the right-hand corner to find your device; double-click to open an SSH session. Students will need to accept the SSH host key warning and enter the device&#39;s password.</p><p><img src=\"/uploads/b2559107-4a9e-adf3-6c5a-6a413d6dca7d.png\" /></p><div class=\"note\">If students prefer, they are welcomed to use <strong>Putty</strong> as an alternative to Smartty.</div>",
                "name" : "Connection Information",
                "id" : "832525100308",
                "path" : "connection-information"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(220, 76, 55);\n    font-weight: bold;\n}</style><h1>Introduction to Viptela</h1><p>Viptela Fabric is a cloud-delivered network fabric that is secure, scalable, open and simple to deploy. Viptela Fabric enables an Enterprise to extend its network footprint to all infrastructure elements using a single platform. This includes branches, campus, remote sites, cloud and data center.</p><p>The enterprise network has evolved significantly as a result of users, devices, and things needing to connect to applications in the cloud. The requirements of the network have significantly evolved as a result. There are pressing requirements both new and old on the current network architecture.</p><p class=\"text-center\"><img src=\"/uploads/a08de4b9-a567-7817-ffcd-5cf1cf0f233d.png\" /></p><p>Viptela has taken a fundamental, grounds-up approach to building the Viptela Fabric. The Viptela Fabric is built on using of time-tested and proven principles of networking but the sophistication is wrapped in a simplified delivery model.</p><ul><li>Separation of control, data, management and orchestration layers</li><li>Integrated routing, security and policy for optimal connectivity</li><li>Built-in optimization techniques for network and applications</li></ul><h2>How does it work?</h2><p>The Viptela solution starts with the initial deployment and configuration of the controller nodes; the vManage, the vSmart and the vBond. These controller nodes establish DTLS/TLS control connections between themselves, thus allowing the vBond to build a mapping table of all controller nodes in the network. This mapping table is what allows for the discovery and onboarding of vEdges, as well as providing vEdges with a NAT traversal information (public and private IP addresses) of deployed vEdges, if applicable. For a secure control plane, the controllers generate the necessary encryption keys and certificates for the establishment of DTLS/TLS tunnels. Additionally, the controller nodes get configured with a list of serial numbers of all connecting vEdges (to allow for the initial vEdge device onboarding).</p><p>When a vEdge is initially deployed, it is configured with the vBond IP address (in addition to basic information such as site ID and organization name). The vEdge then registers (authenticates and is checked against the whitelist) with the vBond, where it retrieves the controller nodes&#39; information for the establishment of DTLS/TLS control connections. Once onboarded, the vEdge joins the Overlay Management Protocol (OMP), where it downloads the fabric control information such as routing information, encryption keys and certificates, which allows it to establish the data plane IPSec connections to other vEdges on the network.</p><div class=\"table-responsive\"><table class=\"table table--bordered\"><tbody><tr><th>&nbsp;</th><th>Name</th><th>Description</th></tr><tr><td><p class=\"text-center\"><img style=\"width: 20%; height: 20%\" src=\"/uploads/a02d8662-4584-2e7a-726f-46572460c03a.png\" /></p></td><td>vEdge</td><td>An Edge platform (vEdge) built for wide ranging applications &ndash; ranging from homes, branches, data centers to virtualized environments like NFV and Cloud.</td></tr><tr><td><p class=\"text-center\"><img style=\"width: 20%; height: 20%\" src=\"/uploads/b98e230f-b65c-f09b-56fc-fc92f6e5e8ad.png\" /></p></td><td>vSmart / vManage / vBond</td><td>A multi-tenant cloud element that provides control &amp; management</td></tr><tr><td><p class=\"text-center\"><img style=\"width: 20%; height: 20%\" src=\"/uploads/11bcfff6-5323-3236-efac-cea42a5dbf55.png\" /></p></td><td>vAnalytics</td><td>An analytics engine (vAnalytics) that obtains application, user and network characteristics to provide predictive analysis and tools for better decision making</td></tr><tr><td><p class=\"text-center\"><img style=\"width: 20%; height: 20%\" src=\"/uploads/1726252f-69bc-ea61-642d-3cd305e37471.png\" /></p></td><td>vOrchestrator</td><td>An orchestration layer (vOrchestrator) that automates &amp; simplifies the provisioning of the infrastructure</td></tr></tbody></table></div>",
                "name" : "Introduction to Viptela",
                "id" : "101081152870",
                "path" : "introduction-to-viptela"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Introduction to the CSP-2100</h1><p>In this lab, students will be deploying virtual vEdge&#39;s onto the <strong>CSP-2100</strong>. The Cloud Services Platform is where <strong>Virtual Network Functions</strong> (also known as VNFs or Services) are deployed, hosted and managed. The CSP-2100 is a KVM hypervisor based on RHEL 7.3 and ConfD. It can be managed via GUI, REST API, NETCONF or ConfD Cisco CLI. The CSP-2100 supports several different image types, including QCOW2, ISO and OVA, and can utilize Day-0 Configuration Files to expedite service deployment and configurations. For storage, the CSP supports HDDs (600GB-1TB), SSDs (400GB-1.6TB) and NFS. Because the CSP-2100 is based on Cisco C-Series Servers, the hardware and the software of CSP is capable of changing and scaling as the UCS product portfolio grows. While the CSP-2100 is more popular in data centers and colocation facilities, it has found success in the branch due to it&#39;s small form factor, flexible configuration options and it&#39;s aggressive price:performance ratio.</p><p>When running on the CSP-2100 VNFs, can utilize a combination of virtual switches, implemented in software or hardware, to deliver networking features. The Cisco CSP-2100 supports three of the most popular choices - OVS, PCIe-PassThrough, and SR-IOV. Each option has its own benefits and tradeoffs. For the purposes of this lab, student vEdge&#39;s will use <strong>OVS</strong>, which offers the most flexible networking options. OVS completely abstracts underlying hardware from the VNF by implementing network switching in a software layer allowing a many to one (N:1) mapping of VNFs to physical NICs. However, this flexibility comes with a significant performance penalty due to all switching implemented in software.</p><div class=\"important-note\">The CSP-2100 used in this lab is named <strong>WISP-vBranch</strong>. The guide will instruct students to perfrom actions on the WISP-vBranch, and may not specifically reference the CSP-2100.</div><p class=\"text-center\"><img src=\"/uploads/b726f5be-dee9-dd50-797b-603cd3135aff.png\" /></p>",
                "name" : "Introduction to the CSP-2100",
                "id" : "566028265849",
                "path" : "introduction-to-the-csp2100"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Deploying the vEdge</h1><p>The first step to setting up your very own Viptela SD-WAN network, is to deploy the virtual machine - or, as often called in Network Functions Virtualization (NFV), virtual network function (VNF) - on the CSP-2100. In this this section, students will use the pre-loaded QCOW2 to deploy a vEdge onto the CSP-2100, WISP-vBranch.</p><p><span class=\"step\">STEP 1:</span> Open a browser window in Chrome and navigate to <strong>WISP-vBranch</strong>. When prompted, login to the CSP-2100 with <strong>student/Cisc#123</strong></p><div class=\"important-note\">Before the login page opens, Chrome may present a certificate error. Click <strong>ADVANCED</strong> and then <strong>Proceed ...</strong> to bypass the warning.</div><p><img src=\"/uploads/0c5a25dd-4793-70b4-9d6b-34df7403c0f0.png\" /></p><p>The page will reload and display the CSP-2100&#39;s Dashboard. The Dashboard gives users a top-down view of their VNFs, providing them with usage data around cores, memory and disk drives. Depending on the number of people currently using the lab environment, the usage metrics displayed may vary slightly.</p><p><span class=\"step\">STEP 2:</span> In the top-right corner, click on <strong>Configuration &gt; Services</strong>.</p><p><img src=\"/uploads/1b017640-42df-1388-ed3f-f6cbed0db665.png\" /></p><p><span class=\"step\">STEP 3:</span> When the Service page loads, click on the <strong>plus symbol (+)</strong> to open the <strong>Create Service Wizard</strong>.</p><p><img src=\"/uploads/93bfcf53-8687-6e4d-0998-cb7d93f70534.png\" /></p><p><span class=\"step\">STEP 4:</span> Before completing the wizard as pictured below, select the radio button that says <strong>&quot;Create Service using Template&quot;</strong>. When the page refreshes, select the only template available from the first drop-down, <strong>student-vEdge.tmpl</strong>. This will automatically populate some of the necessary fields, such as the resource requirements, the image name and the management vNIC (enp1s0f0). <strong>Change the Name to {{student-abbrev}}-vEdge</strong></p><div class=\"important-note\">Students only need to change the <strong>Name</strong> and add the vNICs. Clicking elsewhere in the template (such as on the Image Name or Target Host Name) will cause the template to &quot;reset&quot; to default. If this happens, please reselect the template.</div><p><img src=\"/uploads/7b04a720-06f3-6253-1312-5ffe14792b5b.png\" /></p><p>Before continuing the vEdge needs to be configured with 3 data interfaces. These interfaces connect the vEdge to the LAN segment, as well as both of the public networks - Internet and MPLS. It is these same connections that allow vManage and vBond configure and control the vEdge.</p><p class=\"text-center\"><img style=\"width: 40%; height: 40%\" src=\"/uploads/454d4df6-ec61-0ccd-f9bf-192e5987caa9.png\" /></p><p>The following table includes the necessary information for each vNIC.</p><div class=\"table-responsive\"><table class=\"table table--bordered\"><tbody><tr><th>Connection</th><th>vNIC Name</th><th>CSP Interface</th><th>vEdge Interface</th><th>VLAN</th></tr><tr><td>Internet</td><td>vnic1</td><td>enp1s0f1</td><td>GE0/0</td><td>11{{number}}</td></tr><tr><td>MPLS</td><td>vnic2</td><td>enp1s0f1</td><td>GE0/1</td><td>12{{number}}</td></tr><tr><td>LAN</td><td>vnic3</td><td>enp1s0f1</td><td>GE0/3</td><td>1{{number}}</td></tr></tbody></table></div><div class=\"warning-note\">Please ensure you use the appropriate VLANs for your student pod. The following screenshots are <strong>EXAMPLES</strong>!</div><p><span class=\"step\">STEP 5:</span> Click on the small <strong>plus symbol (+)</strong> to open the <strong>VNIC Configuration Wizard</strong>. When the wizard appears, enter the VLAN for the <strong>Internet vNIC</strong>. From the <strong>Network Name</strong> drop-down, select <strong>enp1s0f1</strong>, which is physical interface connected to both of the public networks. Click <strong>Submit</strong>.</p><p><img src=\"/uploads/160f640d-e01e-638f-be88-cc9f3474412d.png\" /></p><p><span class=\"step\">STEP 6:</span> Repeat this step for <strong>vNIC2</strong> and <strong>vNIC3</strong>. Once completed, the Create Service Wizard should look like the following screenshot with the VLANs matching your student number.</p><p><img src=\"/uploads/8467e4b8-1c70-2e3f-be9e-a23a27594a56.png\" /></p><p><span class=\"step\">STEP 7:</span> Click <strong>Deploy</strong> to start the provisioning process. When the pop-up appears, click on <strong>Close</strong> to navigate back to the main Services page. Wait approximentally 30 seconds before clicking on the <strong>Console Icon</strong> to open a new browser tab for noVNC. Press <strong>Connect</strong> to start the console session with your vEdge. The deployment may take up to 5 minutes.</p><div class=\"note\">Occasionally, the GUI for the CSP-2100 will hang, and will not allow users to open a console session immediately after deploying a service. If clicking the console icon does not open a new browser window, click on <strong>Dashboard &gt; Overview</strong> to navigate away from the Services page, and then click on <strong>Configuration &gt; Services</strong> to return. Clicking on the console icon should now open the noVNC session.</div><p><img src=\"/uploads/aab41de8-9d7f-4401-fbd0-b6b10eede7e0.png\" /></p>",
                "name" : "Deploying the vEdge",
                "id" : "507358934665",
                "path" : "deploying-the-vedge"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Configuring vEdge Management</h1><p>The first step in setting up the vEdge is ensuring it has a management address. In most deployments, the management address configuration is also known as the <strong>Day0 Configuration</strong>. This is going to be the out-of-band IP address used to load the Day1 configuration file.</p><div class=\"note\">The CSP-2100 has a feature that enables users to &quot;side-load&quot; a Day0 Configuration File during VNF deployment. However, this feature needs to also be supported by the VNF. Because Viptela is new to the Cisco NFV ecosystem, this feature is not working as expected on the CSP-2100.</div><p><span class=\"step\">STEP 1:</span> In the noVNC console window, enter the username and password to login to the vEdge - <strong>admin/admin</strong>. It may take approximately 30-60 seconds before the vEdge will accept a login.</p><p><img src=\"/uploads/09ab0ccf-a95a-27fb-1be9-e1e1b64681fa.png\" /></p><p>The management configuration on the vEdge is nearly identical to the management configuration of any other Cisco router - you need an ip address on the interface, and a default route pointing to the default gateway. However, as mentioned in the Viptela Overview, the vEdge uses VPNs to separate interfaces and their traffic. By default, the management interface (eth0) should be assigned to <strong>VPN 512</strong>. VPN 512 is the default VPN on the vEdge and it is used for management connections and functions.</p><p><span class=\"step\">STEP 2:</span> Enter Configuration Mode and configure the vEdge&#39;s management interface. The following screenshot is an example - for {{student-name}} use <strong>10.1.61.{{number}}1/23</strong> for the IP address. Type <strong>Commit</strong> to save the configuration.</p><pre>conf t\nvpn 512\nint eth0\nip address 10.1.61.{{number}}1/23 \nno shut\nexit\nip route 0.0.0.0/0 10.1.60.1\ntop\ncommit\n</pre><p><img src=\"/uploads/86853c53-8589-5f92-94b2-e398b8aae510.png\" /></p><p><span class=\"step\">STEP 3:</span> Verify the configuration was successful. Students can use <strong>(do) show run vpn 512</strong> to verify the configuration in the running-configuration, and <strong>(do) ping 10.1.60.1 vpn 512</strong> to verify the vEdge can reach the default gateway using VPN 512.</p><p><img src=\"/uploads/fea4ce51-bc4f-7608-9766-7a7291892398.png\" /></p><p><span class=\"step\">STEP 4:</span> On the desktop, open Smartty. Using the filter box in the right-hand corner, locate <strong>{{student-abbrev}}-vEdge</strong>. Double-click on the profile, input the password (admin), and ensure the SSH connection establishes. Students will need to accept the Host Key.</p><p><img src=\"/uploads/90068671-4301-4601-aaf2-1b21c7f06995.png\" /></p>",
                "name" : "Configuring vEdge Management",
                "id" : "273105793198",
                "path" : "configuring-vedge-management"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>vEdge Day1 Configuration</h1><p>With the management interface configured, the vEdge is ready to for a <strong>Day1 Configuration File</strong>. The Day1 Configuration File has two main sections - <strong>System</strong> and <strong>VPN 0</strong>.</p><div class=\"important-note\"><strong>The following outputs are for reference only</strong>; students do not need to manually input these configurations. Student configurations continue down below with <strong>Step 1</strong>.</div><h3>System Configuration</h3><p>Besides the host-name, system-ip (management address) and site-id, the System configuration associates the vEdge to the right <strong>Organization</strong> and <strong>vBond</strong>. Both the Organization and the vBond are required for the registering the vEdge with vManage and for pushing policies to the vEdge. The following is an example of the System configuration in the Day1 Configuration File:</p><pre>system\n <strong>host-name               s21-vEdge\n system-ip               10.1.61.211\n site-id                 421</strong>\n no route-consistency-check\n <strong>sp-organization-name    &quot;Cisco Sy1 - 19968&quot;</strong>\n <strong>organization-name       &quot;Cisco Sy1 - 19968&quot;</strong>\n <strong>vbond 172.19.1.233</strong>\n</pre><h3>VPN 0 Configuration</h3><p>The second part of the Day1 Configuration File is for VPN 0. This section configures the 3 data interfaces (Internet, MPLS, LAN) with IP addresses and creates their tunnel-interfaces. In this lab, the vEdge tunnel-interfaces will be using <strong>IPSEC</strong>. Interface GE0/0 has been given a color of <strong>public-internet</strong>, while GE0/1 has been given a color of <strong>mpls</strong>. Colors are similar to tags in MPLS. Because GE0/2 is connected to the LAN, it does not need a tunnel-interface, nor does it need a color; however, it does use a different VPN from the internet interfaces. If you recall, these interfaces map to vNIC1 and vNIC2 on the CSP-2100, which are using VLANs 11{{number}} and 12{{number}} respectively.</p><p>For each interface, there is a default route configured. This default route is responsible for advertising routes to other vEdges, indicating how to reach these subents from different tunnel endpoints.</p><p>The following is an example of the VPN 0 configuration in the Day 1 Configuration File:</p><pre><strong>vpn 0</strong>\n interface ge0/0\n  ip address 10.10.{{number}}.2/24\n  ipv6 dhcp-client\n  <strong>tunnel-interface\n   encapsulation ipsec\n   color public-internet</strong>\n   allow-service all\n   no allow-service bgp\n   allow-service dhcp\n   allow-service dns\n   allow-service icmp\n   no allow-service sshd\n   no allow-service netconf\n   no allow-service ntp\n   no allow-service ospf\n   no allow-service stun\n  !\n  no shutdown\n !\n <strong>ip route 0.0.0.0/0 10.10.{{number}}.1</strong>\n\n interface ge0/1\n  ip address 20.20.{{number}}.2/24\n  ipv6 dhcp-client\n  <strong>tunnel-interface\n   encapsulation ipsec\n   color mpls</strong>\n   allow-service all\n   no allow-service bgp\n   allow-service dhcp\n   allow-service dns\n   allow-service icmp\n   no allow-service sshd\n   no allow-service netconf\n   no allow-service ntp\n   no allow-service ospf\n   no allow-service stun\n  !\n  no shutdown\n !\n ip route 0.0.0.0/0 20.20.{{number}}.1\n!\n\n interface ge0/2\n  ip address 192.168.{{number}}.1/24\n  ipv6 dhcp-client\n  !\n  no shutdown\n !\n <strong>ip route 192.168.{{number}}.0/24 192.168.1.1</strong>\n!\n\n<strong>vpn 100</strong>\n interface ge0/2\n  ip address 192.168.{{number}}.1/24\n  ipv6 dhcp-client\n  !\n  no shutdown\n !\n ip route 192.168.{{number}}.0/24 192.168.1.1\n!\n\nvpn 512\n interface eth0\n  ip address 10.1.61.{{number}}1/23\n  no shutdown\n !\n ip route 0.0.0.0/0 10.1.60.1\n</pre><p>The Day1 Configuration File for each student vEdge has been pre-generated and uploaded to a shared repository.</p><p><span class=\"step\">STEP 1:</span> In the Smartty SSH session, issue the following commands to load the Day1 Configuration File; this is called a <strong>load merge</strong>. The password for the student user on the NFS is <strong>Cisc#123</strong>.</p><pre>request download vpn 512 scp://student@10.1.60.251:/var/student-vEdge-Day1/WISP/{{student-abbrev}}-vEdge-Day1.cfg \nfile list <strong>&lt;-- Ensures the file was successfully downloaded to the vEdge</strong>\nload merge {{student-abbrev}}-vEdge-Day1.cfg \n</pre><p>The following output shows the expected outcome of the load merge:</p><pre>vedge# <strong>request download vpn 512 scp://student@10.1.60.251:/var/student-vEdge-Day1/WISP/{{student-abbrev}}-vEdge-Day1.cfg</strong>\nstudent@10.1.60.251&#39;s password: <strong>Cisc#123</strong>\n{{student-abbrev}}-vEdge-Day1.cfg                                                                                                                                                 100% 1212    53.8KB/s   00:00    \nvedge# <strong>file list</strong>\narchive_id_rsa.pub\n{{student-abbrev}}-vEdge-Day1.cfg\nvedge# <strong>conf t</strong>\nEntering configuration mode terminal\nvedge(config)# <strong>load merge {{student-abbrev}}-vEdge-Day1.cfg</strong>\nvedge(config)# <strong>commit</strong>\nCommit complete.\n<strong>{{student-abbrev}}-vEdge</strong>(config)#\n</pre><p><span class=\"step\">STEP 2:</span> Once the load merge is succcessful, students should notice the name changing from vedge to <strong>{{student-abbrev}}-vEdge</strong>. Verify the rest of the configuration was successfully loaded by issuing a <strong>(do) show run</strong>. The configuration on the device should now match the examples posted above.</p><p><span class=\"step\">STEP 3:</span> The final verification is checking whether or not the vEdge can reach the vBond via VPN 0 - this connectivity is a requirement for registering and configuring the vEdge. On the vEdge CLI, ensure pings to the vBond address (172.19.1.233) via VPN 0 are successful.</p><pre>{{student-abbrev}}-vEdge# <strong>ping 172.19.1.233 vpn 0</strong>\nPing in VPN 0\nPING 172.19.1.233 (172.19.1.233) 56(84) bytes of data.\n64 bytes from 172.19.1.233: icmp_seq=1 ttl=62 time=37.3 ms\n64 bytes from 172.19.1.233: icmp_seq=2 ttl=62 time=21.9 ms\n64 bytes from 172.19.1.233: icmp_seq=3 ttl=62 time=28.4 ms\n64 bytes from 172.19.1.233: icmp_seq=4 ttl=62 time=36.2 ms\n^C\n--- 172.19.1.233 ping statistics ---\n6 packets transmitted, 6 received, 0% packet loss, time 5005ms\nrtt min/avg/max/mdev = 1.690/25.610/37.379/11.908 ms\ns21-vEdge# \n</pre>",
                "name" : "vEdge Day1 Configuration",
                "id" : "490099184316",
                "path" : "vedge-day1-configuration"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Registering the vEdge</h1><p>The last step to provisioning and setting up the vEdge is to register the virtual device with vManage. Registration is accomplished by &quot;checking-out&quot; and activating a <strong>Token</strong> on the vEdge. Each token is associated to a static <strong>Chassis Number</strong>. Whenever the device is torn-down and decommissioned from vManage, a new token is generated, but the Chassis Number remains the same.</p><p>For the purposes of this lab, the tokens have been generated for the student. In a non-lab environment, users would navigate to <strong>Configuration &gt; Devices</strong> on vManage and select <strong>Generate Bootstrap Configuration</strong> for one of the available Chassis Numbers. The screenshot below illustrates this process - <strong>the student does NOT need to generate a token in vManage!</strong></p><p><img src=\"/uploads/c4fab810-e08b-6b25-ea1f-c3f8122d0d34.png\" /></p><p><span class=\"step\">STEP 1:</span> The bootstrap configurations are being stored on a NFS share connected to the Windows jump host. On the desktop, double-click on the folder entitled <strong>vEdge-Bootstraps</strong> and open <strong>{{student-abbrev}}-vEdge-Bootstrap.cfg</strong> in Notepad.</p><div class=\"warning-note\">There is more than one bootstrap file in the folder - <strong>please ensure you open the right one before proceeding!</strong></div><p><img src=\"/uploads/a886692e-b0fc-7186-9c51-1d671bb080d4.png\" /></p><p><span class=\"step\">STEP 2:</span> Because the Day1 Configuration File included both the vBond address and the Organization, the only items needed from the bootstrap configuration file are the token ID and the Chassis Number. Issue the following command on the vEdge CLI, copying and pasting the token ID and the Chassis Number where indicated. The registration process takes approximately 2-3 minutes.</p><pre>request vedge-cloud activate token <strong>(otp)</strong> chassis-number <strong>(uuid)</strong></pre><p><img src=\"/uploads/7f706ee9-a1b6-1839-193c-4af4de9052bc.png\" /></p><p>Once the vEdge is registered with the vManage, it will join the encrypted-overlay and start to communicate with other vEdges on the same &quot;network&quot;. The vEdges will share routes with other vEdges and start propagating statistics back to vManage. The next section will verify this process has started.</p>",
                "name" : "Registering the vEdge",
                "id" : "622961871721",
                "path" : "registering-the-vedge"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Verifying the Registration</h1><p><span class=\"step\">STEP 1:</span> Use the following commands to ensure the registration was successful. The first command indicates whether or not the certificate was accepted and is valid, while the second command lists the active connections between the vEdge and the other Viptela controller VMs - vBond, vSmart and vManage.</p><div class=\"note\">The vEdge is connected and is communicating with the controller VMs via the &quot;internet&quot; connections, NOT out-of-band. In other words, the controller VMs must have ip reachability to the vEdge via the data interfaces in VPN 0.</div><pre>{{student-abbrev}}-vEdge# <strong>show certificate validity</strong>\nThe certificate issued by b3f7d4be-90b1-4933-84e0-f15303f2d2bd is valid from  Jan 4 16:05:02 2018 GMT  (Current date is Thu Jan 4 16:08:35 GMT 2018) &amp; valid until  Jan 2 16:05:02 2028 GMT\n{{student-abbrev}}-vEdge# <strong>show control connections</strong>\n                                                                                       PEER                                          PEER                                    CONTROLLER \nPEER    PEER PEER            SITE       DOMAIN PEER                                    PRIV  PEER                                    PUB                                     GROUP      \nTYPE    PROT SYSTEM IP       ID         ID     PRIVATE IP                              PORT  PUBLIC IP                               PORT  LOCAL COLOR     STATE UPTIME      ID         \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\nvsmart  dtls 10.1.48.232     1000       1      172.19.1.232                            12346 172.19.1.232                            12346 public-internet up    0:00:01:08  0           \nvsmart  dtls 10.1.48.232     1000       1      172.19.1.232                            12346 172.19.1.232                            12346 mpls            up    0:00:01:19  0           \nvbond   dtls -               0          0      172.19.1.233                            12346 172.19.1.233                            12346 public-internet up    0:00:01:09  0           \nvbond   dtls -               0          0      172.19.1.233                            12346 172.19.1.233                            12346 mpls            up    0:00:01:20  0           \nvmanage dtls 10.1.48.231     1000       0      172.19.1.231                            12346 172.19.1.231                            12346 mpls            up    0:00:01:04  0           \n</pre><p><span class=\"step\">STEP 2:</span> The next item to verify is the routing table. In the following output, students can see from which VPN they are learning each route, as well as the protocol. The routes being learned from WISP-vEdge are marked with a <strong>omp</strong>, as they are being learned via the encryted, overlay tunnels. They are also marked with their <strong>color</strong>. Most importantly however, is the <strong>TLOC IP</strong> which indicates from which vEdge the routes are being learned. The TLOC IP is used to tell the student-vEdge where to send the traffic desitined for a 172.1.x.y/24 subnet.</p><div class=\"note\">The vEdges in this lab are part of a greater setup. Therefore, it is expected to see different, and many more, routes listed.</div><pre>{{student-abbrev}}-vEdge# <strong>show ip route</strong>\nCodes Proto-sub-type:\n  IA -&gt; ospf-intra-area, IE -&gt; ospf-inter-area,\n  E1 -&gt; ospf-external1, E2 -&gt; ospf-external2,\n  N1 -&gt; ospf-nssa-external1, N2 -&gt; ospf-nssa-external2,\n  e -&gt; bgp-external, i -&gt; bgp-internal\nCodes Status flags:\n  F -&gt; fib, S -&gt; selected, I -&gt; inactive,\n  B -&gt; blackhole, R -&gt; recursive\n\n                                            PROTOCOL  NEXTHOP     NEXTHOP          NEXTHOP                                                   \nVPN    PREFIX              <strong>PROTOCOL</strong>         SUB TYPE  IF NAME     ADDR             VPN      <strong>TLOC IP</strong>          <strong>COLOR</strong>            ENCAP  STATUS  \n---------------------------------------------------------------------------------------------------------------------------------------------\n0      0.0.0.0/0           static           -         ge0/0       10.10.{{number}}.1       -        -                -                -      F,S     \n0      0.0.0.0/0           static           -         ge0/1       20.20.{{number}}.1       -        -                -                -      F,S     \n0      10.1.61.{{number}}1/32      connected        -         system      -                -        -                -                -      F,S     \n0      10.10.{{number}}.0/24       connected        -         ge0/0       -                -        -                -                -      F,S     \n0      20.20.{{number}}.0/24       connected        -         ge0/1       -                -        -                -                -      F,S     \n100    172.1.1.0/24        <strong>omp</strong>              -         -           -                -        10.1.60.71       <strong>mpls</strong>             ipsec  F,S     \n100    172.1.1.0/24        <strong>omp</strong>              -         -           -                -        10.1.60.71       <strong>public-internet</strong>  ipsec  F,S     \n100    172.1.2.0/24        <strong>omp</strong>              -         -           -                -        10.1.60.72       <strong>mpls</strong>             ipsec  F,S     \n100    172.1.2.0/24        <strong>omp</strong>              -         -           -                -        10.1.60.72       <strong>public-internet</strong>  ipsec  F,S     \n100    192.168.{{number}}.0/24     connected        -         ge0/2       -                -        -                -                -      F,S     \n512    0.0.0.0/0           static           -         eth0        10.1.60.1        -        -                -                -      F,S     \n512    10.1.60.0/23        connected        -         eth0        -                -        -                -                -      F,S     \n</pre><p>In order to actually test the tunnels and routes, there is a pair of VMs that students can use to generate traffic. <strong>WISP-Client</strong> is sitting behind the student-vEdge on WISP-vBranch, while the <strong>WISP-Test-Device</strong> resides in the data center.</p><p><span class=\"step\">STEP 3:</span> On the desktop, open Smartty. Using the filter box in the right-hand corner, locate <strong>WISP-Client</strong>. Double-click on the profile, input the password (Cisc#123). Students can send pings from one test device to another. Please make sure to use <strong>-I</strong> to indicate the correct interface - there is one jump host, with many different sub-interfaces.</p><pre>[student@WISP-Client ~]# <strong>ping -I ens192.1{{number}} 172.1.2.{{number}}</strong>\nPING 172.1.2.{{number}} (172.1.2.{{number}}) from 192.168.{{number}}.2 ens192.1{{number}}: 56(84) bytes of data.\n64 bytes from 172.1.2.{{number}}: icmp_seq=1 ttl=62 time=47.6 ms\n64 bytes from 172.1.2.{{number}}: icmp_seq=2 ttl=62 time=28.8 ms\n64 bytes from 172.1.2.{{number}}: icmp_seq=3 ttl=62 time=65.8 ms\n64 bytes from 172.1.2.{{number}}: icmp_seq=4 ttl=62 time=27.9 ms\n^C\n--- 172.1.2.100 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3005ms\nrtt min/avg/max/mdev = 27.923/42.564/65.886/15.598 ms\n</pre>",
                "name" : "Verifying the Registration",
                "id" : "646595115989",
                "path" : "verifying-the-registration"
            },
            {
                "data" : "<style type=\"text/css\">span.step {\n    color: rgb(240, 76, 55);\n    font-weight: bold;\n}</style><h1>Attaching Template Policies</h1><p>Once the vEdge is registered with vManage, students can use <strong>Templates</strong> to configure the device. While templates can be used for consistent configurations they can also be used for per-device flexibility. Templates are attached to provisioned vEdge routers, and variables are used for rapid bulk configuration rollout with unique per-device settings. Once a vEdge has been configured with a template <strong>local configuration changes are not allowed</strong>; this prevents configuration drift.</p><p>Students will use vManage and templates to apply an <strong>ACL-Policy</strong> to their student-vEdge. The policy simply denies return traffic from the subnet of the WISP-Test-Device.</p><p><img src=\"/uploads/7163337e-c4bd-3dda-ed30-1cae6acf6a07.png\" /></p><p><span class=\"step\">STEP 1:</span> Open a browser window in Chrome and navigate to <strong><a href=\"http://10.1.48.231\">vManage</a></strong>. When prompted, login to vManage with <strong>student/Cisc#123</strong>.</p><p><img src=\"/uploads/3a050fd3-1c6e-d385-fe0a-d1ae02bf2df1.png\" /></p><p><span class=\"step\">STEP 2:</span> On the left-hand side of the vManage GUI, hover over the small gear icon and select <strong>Configuration &gt; Templates</strong> from the drop-down.</p><p><img src=\"/uploads/89425e18-14af-5152-6114-8db8911ab1ae.png\" /></p><p><span class=\"step\">STEP 3:</span> When the page refreshes, click on the small dots and select <strong>Attach Devices</strong> from the drop-down.</p><p><img src=\"/uploads/2abfe277-4c4a-2ab2-d18a-e9b554ed177e.png\" /></p><p><span class=\"step\">STEP 4:</span> Once the Attach Devices wizard appears, in the left-hand section entitled <strong>Available Devices</strong>, scroll-down and select <strong>{{student-abbrev}}-vEdge</strong>. With the correct device highlighted, click on the light-blue cirlce in the middle of the wizard to move the device into the right section entitled <strong>Selected Devices</strong>. Click <strong>Attach</strong> to continue.</p><div class=\"warning-note\">Please ensure you select the correct vEdge, as selecting another vEdge may prevent you from completeting this section successfully.</div><p><img src=\"/uploads/62a2ab13-63cb-7289-5226-c639acc878dc.png\" /></p><p><span class=\"step\">STEP 5:</span> When the page reloads, your student-vEdge should be listed under the <strong>WISP-vEdge-Template</strong>. The next step is to update the template with your vEdge information. Click on the same small dots and select <strong>Edit Device Template</strong> from the drop-down. Use the information in the following table to complete the device template. Once completed, click <strong>Update</strong> and then <strong>Next</strong></p><div class=\"important-note\">The following screenshot is an <strong>EXAMPLE</strong>. Please use the correct information from the following configuration output.</div><pre>system\n host-name               s{{number}}-vEdge\n system-ip               10.1.61.{{number}}1\n site-id                 4{{number}} <strong>&lt;-- Site ID</strong>\nvpn 0\n interface ge0/0\n  ip address 10.10.{{number}}.2/24 <strong>&lt;-- GE0/0_IP_Addr</strong>\n\n interface ge0/1\n  ip address 20.20.{{number}}.2/24 <strong>&lt;-- GE0/1_IP_Addr</strong>\n\n ip route 0.0.0.0/0 10.10.{{number}}.1 <strong>&lt;-- VPN0_GW-1</strong>\n ip route 0.0.0.0/0 20.20.{{number}}.1 <strong>&lt;-- VPN0_GW-2</strong>\n!\n\nvpn 100\n interface ge0/2\n  ip address 192.168.{{number}}.1/24 <strong>&lt;-- GE0/2_IP_Addr</strong>\n  no shutdown\n !\n!\n\nvpn 512\n interface eth0\n  ip address 10.1.61.{{number}}1/23 <strong>&lt;-- Mgmt_IP_Addr</strong>\n</pre><p><img src=\"/uploads/58333a39-197f-8632-cdfa-a672391786ee.png\" /></p><p><span class=\"step\">STEP 6:</span> Before attaching the template, students can perform a <strong>Config Diff</strong> to see the expected changes to their student-vEdge. On the left-hand side of the GUI, click on your device - it should be the only one listed. Then, on the right-hand side, click on Config Diff before selecting the <strong>Side by Side Diff</strong> radio button. Scroll to the bottom of the output to see the ACL configuration under <strong>New Configuration</strong> on the right. Click <strong>Configure Devices</strong> to continue.</p><div class=\"important-note\">In this ouput, vManage shows <strong>EVERY</strong> configuration difference, including the missing default configurations. Unfortunately, this means the output on the left shows configuration &quot;missing&quot; despite actually being present.</div><p><img src=\"/uploads/24fec9cc-6725-22aa-d6dc-c4e8707f6d3d.png\" /></p><p><span class=\"step\">STEP 7:</span> The configuration should take approximentally 30 seconds. Once the configuration is completed, the GUI will refresh and status will be listed as <strong>Success</strong>.</p><p><img src=\"/uploads/868b266d-362c-43f4-68a7-3d510121dd9e.png\" /></p><p><span class=\"step\">STEP 8:</span> Students can verify the configuration by using vManage to view the local configuration on the device. In the left-hand menu, hover over the small gear icon and select <strong>Configuration &gt; Devices</strong> from the drop-down. Once the main panel refreshes, find your student-vEdge, click on the small dots to the right and select <strong>Local Configuration</strong> from the drop-down. Once the Local Configuration window appears, scroll-down and identify the ACL-Policy.</p><div class=\"important-note\">Students can click the column headers on the Devices page to sort the rows - try clicking on <strong>Hostname</strong> to make it easier to find your student-vEdge.</div><p><img src=\"/uploads/a2e5fff3-f9e7-88db-2b9c-94225cbae45c.png\" /></p><p><span class=\"step\">STEP 9:</span> In the WISP-Client Smartty session, attempt to ping the same WISP-Test-Client - it should fail.</p><pre>[student@WISP-Client ~]# <strong>ping -I ens192.12{{number}} 172.1.2.{{number}}</strong>\nPING 172.1.2.25 (172.1.2.25) from 192.168.25.2 ens192.125: 56(84) bytes of data.\nFrom 192.168.{{number}}.1 icmp_seq=1 Destination Port Unreachable\nFrom 192.168.{{number}}.1 icmp_seq=2 Destination Port Unreachable\nFrom 192.168.{{number}}.1 icmp_seq=3 Destination Port Unreachable\nFrom 192.168.{{number}}.1 icmp_seq=4 Destination Port Unreachable\n^C\n--- 172.1.2.{{number}} ping statistics ---\n4 packets transmitted, 0 received, +4 errors, 100% packet loss, time 3000ms\n\n[student@WISP-Client ~]# \n</pre><p><span class=\"step\">STEP 10:</span> And finally, in the s{{number}}-vEdge Smartty session, attempt to configure VPN 100 - this should also fail. Once a device is being managed by vManage, it cannot be managed individually.</p><pre>s{{number}}-vEdge# conf t\ns{{number}}-vEdge(config)# vpn 100  \ns{{number}}-vEdge(config-vpn-100)# int ge0/2\ns{{number}}-vEdge(config-interface-ge0/2)# shut\ns{{number}}-vEdge(config-interface-ge0/2)# top\ns{{number}}-vEdge(config)# commit\n<strong>Aborted: &#39;system is-vmanaged&#39;: This device is being managed by the vManage. Configuration through the CLI is not allowed.</strong>\n</pre>",
                "name" : "Attaching Template Policies",
                "id" : "533196066967",
                "path" : "attaching-template-policies"
            },
            {
                "data" : "<div class=\"important-note\"><strong>Please do NOT log out when completing the lab. The proctor will need to reset the pod for the next student.</strong></div><h1 class=\"text-center\">Thank you for completing our WISP lab at Cisco Live Barcelona 2018!</h1><p class=\"text-center\">We really hope you enjoyed our lab, and we hope you enjoy the rest of your conference experience. Participants are welcomed to stay in-touch with the lab proctors via email.</p><h3 class=\"text-center\">Please Remember to complete your surveys!</h3><p class=\"text-center\"><img style=\"width: 60%; height: 60%\" src=\"/images/SVS_Logo.png\" /></p><h1 class=\"text-center\">Visit us at <a href=\"http://getsvs.cisco.com/\"><strong>getsvs.cisco.com</strong></a>!</h1>",
                "name" : "Thank You!",
                "id" : "23086011088",
                "path" : "thank-you"
            }
        ]
    },
    (err, course) => {
        if (err) {
            console.log(err);
        }
        console.log(course);

        process.exit(0);
    }
);